<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vite 依赖星系图</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #000;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
    .container {
      width: 100vw;
      height: 100vh;
      position: relative;
    }
    .controls {
      position: fixed;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 8px;
      color: white;
      max-width: 250px;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .controls h3 {
      margin-top: 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      padding-bottom: 8px;
      margin-bottom: 12px;
    }
    .controls p {
      margin: 8px 0;
      font-size: 14px;
      display: flex;
      align-items: center;
    }
    .controls .key {
      background: rgba(255, 255, 255, 0.1);
      padding: 2px 6px;
      border-radius: 4px;
      margin-right: 8px;
      font-family: monospace;
      font-size: 13px;
    }
    .info-panel {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 8px;
      color: white;
      max-width: 300px;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .config-panel {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 8px;
      color: white;
      max-width: 300px;
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .config-panel h3 {
      margin-top: 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      padding-bottom: 8px;
      margin-bottom: 12px;
    }
    .config-panel .form-group {
      margin-bottom: 12px;
    }
    .config-panel label {
      display: block;
      margin-bottom: 5px;
      font-size: 14px;
    }
    .config-panel input {
      width: 100%;
      padding: 8px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(0, 0, 0, 0.5);
      color: white;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .config-panel button {
      background: #8884d8;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
      width: 100%;
    }
    .config-panel button:hover {
      background: #706ac5;
    }
    .node-label {
      pointer-events: none;
      white-space: nowrap;
      text-shadow: 0 0 2px #000;
    }
    @media (max-width: 768px) {
      .controls, .config-panel, .info-panel {
        max-width: 45%;
        font-size: 12px;
        padding: 10px;
      }
      .controls p, .config-panel label {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <deps-galaxy id="galaxy" src="./deps.json"></deps-galaxy>
  </div>

  <div class="controls">
    <h3>控制说明</h3>
    <p><span class="key">鼠标拖拽</span> 旋转视角</p>
    <p><span class="key">鼠标滚轮</span> 缩放</p>
    <p><span class="key">W/A/S/D</span> 移动视角</p>
    <p><span class="key">单击</span> 显示节点详情</p>
    <p><span class="key">双击</span> 打开源码</p>
  </div>

  <div class="config-panel">
    <h3>配置选项</h3>
    <div class="form-group">
      <label for="data-path">数据文件路径</label>
      <input type="text" id="data-path" value="./deps.json" placeholder="输入deps.json文件路径">
    </div>
    <div class="form-group">
      <label for="theme-color">主题颜色</label>
      <input type="color" id="theme-color" value="#8884d8">
    </div>
    <button id="apply-config">应用配置</button>
  </div>

  <div class="info-panel" id="node-info">
    选择节点查看详情
  </div>

  <script type="module">
    // 导入自定义元素
    import DepsGalaxy from './src/web-component.js';

    // 定义自定义元素
    if (!customElements.get('deps-galaxy')) {
      customElements.define('deps-galaxy', DepsGalaxy);
    }

    // 配置应用
    document.getElementById('apply-config').addEventListener('click', () => {
      const galaxyElement = document.getElementById('galaxy');
      const dataPath = document.getElementById('data-path').value;
      const themeColor = document.getElementById('theme-color').value;

      if (galaxyElement) {
        galaxyElement.setAttribute('src', dataPath);
        galaxyElement.setAttribute('theme-color', themeColor);
        document.getElementById('node-info').textContent = '配置已应用，正在加载数据...';
      }
    });

    // 监听节点点击事件
    const galaxyElement = document.getElementById('galaxy');
    if (galaxyElement) {
      // 这里可以扩展更多自定义功能
      galaxyElement.options = {
        onNodeClick: (node) => {
          const infoPanel = document.getElementById('node-info');
          if (infoPanel) {
            infoPanel.innerHTML = `
              <h4>${node.name}</h4>
              <p><strong>ID:</strong> ${node.id}</p>
              <p><strong>大小:</strong> ${formatBytes(node.size)}</p>
              <p><strong>依赖数:</strong> ${node.dependencies?.length || 0}</p>
              ${node.path ? `<p><strong>路径:</strong> ${node.path}</p>` : ''}
            `;
          }
        },
        preRender: (data, scene) => {
          // 可以在这里添加自定义光源、背景等
          const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
          directionalLight.position.set(1, 1, 1);
          scene.add(directionalLight);
        }
      };
    }

    // 字节格式化工具函数
    function formatBytes(bytes, decimals = 2) {
      if (bytes === 0) return '0 Bytes';

      const k = 1024;
      const dm = decimals < 0 ? 0 : decimals;
      const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];

      const i = Math.floor(Math.log(bytes) / Math.log(k));

      return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
    }
  </script>
</body>
</html>